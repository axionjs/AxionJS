{
  "$schema": "http://localhost:3001/schema/registry-item.json",
  "name": "mail",
  "type": "registry:auth",
  "author": "axionjs (https://www.axionjs.com)",
  "description": "Mail functions for sending emails.",
  "dependencies": [
    "nodemailer",
    "@react-email/components",
    "@react-email/render"
  ],
  "registryDependencies": [
    "verification-email",
    "reset-password-email",
    "two-factor-email"
  ],
  "files": [
    {
      "path": "auth/lib/mail.ts",
      "content": "import nodemailer from \"nodemailer\";\r\nimport { render } from \"@react-email/render\";\r\nimport VerificationEmail from \"@/registry/new-york/auth/emails/verification-email\";\r\nimport ResetPasswordEmail from \"@/registry/new-york/auth/emails/reset-password-email\";\r\nimport TwoFactorAuthEmail from \"@/registry/new-york/auth/emails/two-factor-email\";\r\n\r\nexport const transporter = nodemailer.createTransport({\r\n  host: process.env.EMAIL_SERVER_HOST,\r\n  port: Number(process.env.EMAIL_SERVER_PORT),\r\n  auth: {\r\n    user: process.env.EMAIL_SERVER_USER,\r\n    pass: process.env.EMAIL_SERVER_PASSWORD,\r\n  },\r\n});\r\n\r\nexport const sendVerificationEmail = async (\r\n  email: string,\r\n  token: string,\r\n  isEmailChange = false,\r\n) => {\r\n  // Add emailChange parameter to the URL for email changes\r\n  const confirmLink = `${process.env.NEXT_PUBLIC_APP_URL}/auth/verify?token=${token}${isEmailChange ? \"&emailChange=true\" : \"\"}`;\r\n\r\n  const emailHtml = await render(VerificationEmail({ confirmLink }));\r\n\r\n  await transporter.sendMail({\r\n    from: `AxionJS - Test <${process.env.EMAIL_FROM}>`,\r\n    to: email,\r\n    subject: isEmailChange\r\n      ? \"Confirm your new email address\"\r\n      : \"Confirm your email address\",\r\n    html: emailHtml,\r\n  });\r\n};\r\n\r\nexport const sendPasswordResetEmail = async (email: string, token: string) => {\r\n  const resetLink = `${process.env.NEXT_PUBLIC_APP_URL}/auth/new-password?token=${token}`;\r\n\r\n  const emailHtml = await render(ResetPasswordEmail({ resetLink }));\r\n\r\n  await transporter.sendMail({\r\n    from: `AxionJS - Test <${process.env.EMAIL_FROM}>`,\r\n    to: email,\r\n    subject: \"Reset your password\",\r\n    html: emailHtml,\r\n  });\r\n};\r\n\r\nexport const sendTwoFactorTokenEmail = async (email: string, token: string) => {\r\n  const emailHtml = await render(\r\n    TwoFactorAuthEmail({ verificationToken: token }),\r\n  );\r\n\r\n  await transporter.sendMail({\r\n    from: `AxionJS - Test <${process.env.EMAIL_FROM}>`,\r\n    to: email,\r\n    subject: \"2FA Verification Code\",\r\n    html: emailHtml,\r\n  });\r\n};\r\n",
      "type": "registry:lib",
      "target": ""
    }
  ]
}